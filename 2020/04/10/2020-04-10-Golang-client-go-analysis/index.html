<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Golang client-go 源码分析 | Frederick Hou Blog</title><meta name="description" content="Golang client-go 源码分析"><meta name="keywords" content="Golang"><meta name="author" content="Frederick Hou"><meta name="copyright" content="Frederick Hou"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Golang client-go 源码分析"><meta name="twitter:description" content="Golang client-go 源码分析"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg3.png"><meta property="og:type" content="article"><meta property="og:title" content="Golang client-go 源码分析"><meta property="og:url" content="http://yoursite.com/2020/04/10/2020-04-10-Golang-client-go-analysis/"><meta property="og:site_name" content="Frederick Hou Blog"><meta property="og:description" content="Golang client-go 源码分析"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg3.png"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '2'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2020/04/10/2020-04-10-Golang-client-go-analysis/"><link rel="prev" title="Golang 工厂模式" href="http://yoursite.com/2020/04/12/2020-04-11-Golang-factory-model/"><link rel="next" title="死锁介绍" href="http://yoursite.com/2020/04/09/2020-04-09-linux_dead_mutex/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c9a7c17cc51ad5aae5db3c12ae1f725d";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: {"text":"富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">22</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">1</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li><li><a class="site-page" href="/picture/"><i class="fa-fw fa fa-picture-o"></i><span> Gallery</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#client-go-源码分析"><span class="toc-number">1.</span> <span class="toc-text">client-go 源码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#client-go-简介"><span class="toc-number">1.1.</span> <span class="toc-text">client-go 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#client-go-源码目录结构"><span class="toc-number">1.2.</span> <span class="toc-text">client-go 源码目录结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#示例代码"><span class="toc-number">1.2.1.</span> <span class="toc-text">示例代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#kubeconfig"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">kubeconfig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rest-config-对象"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">rest.config 对象</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Clientset对象创建"><span class="toc-number">1.2.2.</span> <span class="toc-text">Clientset对象创建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Clientset-结构体"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">Clientset 结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Clientset-实现的接口"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">Clientset 实现的接口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CoreV1Client对象创建"><span class="toc-number">1.2.3.</span> <span class="toc-text">CoreV1Client对象创建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NewForConfig"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">NewForConfig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CoreV1Interface"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">CoreV1Interface</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CoreV1Client-结构体"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">CoreV1Client 结构体</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PodsGetter接口"><span class="toc-number">1.2.4.</span> <span class="toc-text">PodsGetter接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pod对象创建"><span class="toc-number">1.2.5.</span> <span class="toc-text">Pod对象创建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PodInterface接口"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">PodInterface接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pod结构体"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">Pod结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pod-List方法"><span class="toc-number">1.2.5.3.</span> <span class="toc-text">Pod List方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rest-client-对象创建"><span class="toc-number">1.2.6.</span> <span class="toc-text">rest client 对象创建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rest-Interface"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">rest.Interface</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RESTClient结构体"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">RESTClient结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RESTClient对象实现的接口函数"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">RESTClient对象实现的接口函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NewRequest"><span class="toc-number">1.2.6.4.</span> <span class="toc-text">NewRequest</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">1.3.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#client-go对k8s资源的调用"><span class="toc-number">1.4.</span> <span class="toc-text">client-go对k8s资源的调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Service"><span class="toc-number">1.4.1.</span> <span class="toc-text">Service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Deployment"><span class="toc-number">1.4.2.</span> <span class="toc-text">Deployment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReplicaSet"><span class="toc-number">1.4.3.</span> <span class="toc-text">ReplicaSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ingresse"><span class="toc-number">1.4.4.</span> <span class="toc-text">Ingresse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#StatefulSet"><span class="toc-number">1.4.5.</span> <span class="toc-text">StatefulSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DaemonSet"><span class="toc-number">1.4.6.</span> <span class="toc-text">DaemonSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReplicationController"><span class="toc-number">1.4.7.</span> <span class="toc-text">ReplicationController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Secret"><span class="toc-number">1.4.8.</span> <span class="toc-text">Secret</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConfigMap"><span class="toc-number">1.4.9.</span> <span class="toc-text">ConfigMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pod"><span class="toc-number">1.4.10.</span> <span class="toc-text">Pod</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Namespace"><span class="toc-number">1.4.11.</span> <span class="toc-text">Namespace</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg3.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Frederick Hou Blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li><li><a class="site-page" href="/picture/"><i class="fa-fw fa fa-picture-o"></i><span> Gallery</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Golang client-go 源码分析</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-04-10 00:00:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-04-10</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-04-16 16:31:04"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-04-16</span></time></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3.3k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 18 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2020/04/10/2020-04-10-Golang-client-go-analysis/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="client-go-源码分析"><a href="#client-go-源码分析" class="headerlink" title="client-go 源码分析"></a>client-go 源码分析</h1><h2 id="client-go-简介"><a href="#client-go-简介" class="headerlink" title="client-go 简介"></a>client-go 简介</h2><p>client-go是一个调用kubernetes集群资源对象API的客户端，即通过client-go实现对kubernetes集群中资源对象（包括deployment、service、ingress、replicaSet、pod、namespace、node等）的增删改查等操作。大部分对kubernetes进行前置API封装的二次开发都通过client-go这个第三方包来实现。</p>
<p>​client-go官方文档：<a href="https://github.com/kubernetes/client-go" target="_blank" rel="noopener">https://github.com/kubernetes/client-go</a></p>
<h2 id="client-go-源码目录结构"><a href="#client-go-源码目录结构" class="headerlink" title="client-go 源码目录结构"></a>client-go 源码目录结构</h2><ul>
<li>The <strong>kubernetes</strong> package contains the clientset to access Kubernetes API.</li>
<li>The <strong>discovery</strong> package is used to discover APIs supported by a Kubernetes API server.</li>
<li>The <strong>dynamic</strong> package contains a dynamic client that can perform generic operations on arbitrary Kubernetes API objects.</li>
<li>The <strong>transport</strong> package is used to set up auth and start a connection.</li>
<li>The <strong>tools/cache</strong> package is useful for writing controllers.</li>
</ul>
<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><pre><code>#demo.go
package main

import (
    &quot;flag&quot;
    &quot;fmt&quot;
    &quot;os&quot;
    &quot;path/filepath&quot;
    &quot;time&quot;

    metav1 &quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;
    &quot;k8s.io/client-go/kubernetes&quot;
    &quot;k8s.io/client-go/tools/clientcmd&quot;
)

func main() {
    kubeconfig := ./config
    config, err := clientcmd.BuildConfigFromFlags(&quot;&quot;, kubeconfig)
    if err != nil {
        panic(err.Error())
    }
    // creates the clientset
    clientset, err := kubernetes.NewForConfig(config)
    if err != nil {
        panic(err.Error())
    }
    pods, err := clientset.CoreV1().Pods(&quot;&quot;).List(metav1.ListOptions{})
    if err != nil {
        panic(err.Error())
    }
    fmt.Printf(&quot;There are %d pods in the cluster\n&quot;, len(pods.Items))
}</code></pre><p>client-go库版本</p>
<pre><code>go get  k8s.io/client-go v0.0.0-20191114101535-6c5935290e33</code></pre><h4 id="kubeconfig"><a href="#kubeconfig" class="headerlink" title="kubeconfig"></a>kubeconfig</h4><p>获取kubernetes配置文件kubeconfig的绝对路径。一般路径为$HOME/.kube/config。该文件主要用来配置本地连接的kubernetes集群。config配置文件支持集群内和集群外访问方式。(只要在网络策略访问范围内)</p>
<p><strong>config文件形式如下所示：</strong></p>
<pre><code>apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: { .Certificate-authority-data}
    server: https://ip:6443
name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: {}
users:
- name: kubernetes-admin
user:
    client-certificate-data: { .Client-certificate-data}
    client-key-data: { .Client-key-data}</code></pre><h4 id="rest-config-对象"><a href="#rest-config-对象" class="headerlink" title="rest.config 对象"></a>rest.config 对象</h4><pre><code>config, err := clientcmd.BuildConfigFromFlags(&quot;&quot;, kubeconfig)</code></pre><p>通过参数（master的url或者kubeconfig路径）用BuildConfigFromFlags方法来获取rest.Config对象，一般是通过参数kubeconfig的路径。</p>
<h3 id="Clientset对象创建"><a href="#Clientset对象创建" class="headerlink" title="Clientset对象创建"></a>Clientset对象创建</h3><pre><code>clientset, err := kubernetes.NewForConfig(config)</code></pre><p>通过config对象为入参，调用NewForConfig函数获取clients对象，clients是多个client的集合。里面包含着各个版本的client。源码地址：k8s.io/client-go/kubernetes/clientset.go</p>
<pre><code>// NewForConfig creates a new Clientset for the given config.
// If config&apos;s RateLimiter is not set and QPS and Burst are acceptable,
// NewForConfig will generate a rate-limiter in configShallowCopy.
func NewForConfig(c *rest.Config) (*Clientset, error) {
    configShallowCopy := *c
    if configShallowCopy.RateLimiter == nil &amp;&amp; configShallowCopy.QPS &gt; 0 {
        if configShallowCopy.Burst &lt;= 0 {
            return nil, fmt.Errorf(&quot;Burst is required to be greater than 0 when RateLimiter is not set and QPS is set to greater than 0&quot;)
        }
        configShallowCopy.RateLimiter = flowcontrol.NewTokenBucketRateLimiter(configShallowCopy.QPS, configShallowCopy.Burst)
    }
    var cs Clientset
    var err error
    cs.admissionregistrationV1, err = admissionregistrationv1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.admissionregistrationV1beta1, err = admissionregistrationv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.appsV1, err = appsv1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.appsV1beta1, err = appsv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.appsV1beta2, err = appsv1beta2.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.auditregistrationV1alpha1, err = auditregistrationv1alpha1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.authenticationV1, err = authenticationv1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.authenticationV1beta1, err = authenticationv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.authorizationV1, err = authorizationv1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.authorizationV1beta1, err = authorizationv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.autoscalingV1, err = autoscalingv1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.autoscalingV2beta1, err = autoscalingv2beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.autoscalingV2beta2, err = autoscalingv2beta2.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.batchV1, err = batchv1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.batchV1beta1, err = batchv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.batchV2alpha1, err = batchv2alpha1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.certificatesV1beta1, err = certificatesv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.coordinationV1beta1, err = coordinationv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.coordinationV1, err = coordinationv1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    //coreV1 对象创建
    cs.coreV1, err = corev1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.discoveryV1alpha1, err = discoveryv1alpha1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.eventsV1beta1, err = eventsv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.extensionsV1beta1, err = extensionsv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.networkingV1, err = networkingv1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.networkingV1beta1, err = networkingv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.nodeV1alpha1, err = nodev1alpha1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.nodeV1beta1, err = nodev1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.policyV1beta1, err = policyv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.rbacV1, err = rbacv1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.rbacV1beta1, err = rbacv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.rbacV1alpha1, err = rbacv1alpha1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.schedulingV1alpha1, err = schedulingv1alpha1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.schedulingV1beta1, err = schedulingv1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.schedulingV1, err = schedulingv1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.settingsV1alpha1, err = settingsv1alpha1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.storageV1beta1, err = storagev1beta1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.storageV1, err = storagev1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    cs.storageV1alpha1, err = storagev1alpha1.NewForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }

    cs.DiscoveryClient, err = discovery.NewDiscoveryClientForConfig(&amp;configShallowCopy)
    if err != nil {
        return nil, err
    }
    return &amp;cs, nil
}</code></pre><p>NewForConfig函数根据传入的rest.config对象创建一个Clientset对象,此对象可以操作CoreV1()方法。</p>
<h4 id="Clientset-结构体"><a href="#Clientset-结构体" class="headerlink" title="Clientset 结构体"></a>Clientset 结构体</h4><p><strong>其结构体具体参数如下所示：</strong></p>
<pre><code>// Clientset contains the clients for groups. Each group has exactly one
// version included in a Clientset.
type Clientset struct {
    *discovery.DiscoveryClient
    admissionregistrationV1      *admissionregistrationv1.AdmissionregistrationV1Client
    admissionregistrationV1beta1 *admissionregistrationv1beta1.AdmissionregistrationV1beta1Client
    appsV1                       *appsv1.AppsV1Client
    appsV1beta1                  *appsv1beta1.AppsV1beta1Client
    appsV1beta2                  *appsv1beta2.AppsV1beta2Client
    auditregistrationV1alpha1    *auditregistrationv1alpha1.AuditregistrationV1alpha1Client
    authenticationV1             *authenticationv1.AuthenticationV1Client
    authenticationV1beta1        *authenticationv1beta1.AuthenticationV1beta1Client
    authorizationV1              *authorizationv1.AuthorizationV1Client
    authorizationV1beta1         *authorizationv1beta1.AuthorizationV1beta1Client
    autoscalingV1                *autoscalingv1.AutoscalingV1Client
    autoscalingV2beta1           *autoscalingv2beta1.AutoscalingV2beta1Client
    autoscalingV2beta2           *autoscalingv2beta2.AutoscalingV2beta2Client
    batchV1                      *batchv1.BatchV1Client
    batchV1beta1                 *batchv1beta1.BatchV1beta1Client
    batchV2alpha1                *batchv2alpha1.BatchV2alpha1Client
    certificatesV1beta1          *certificatesv1beta1.CertificatesV1beta1Client
    coordinationV1beta1          *coordinationv1beta1.CoordinationV1beta1Client
    coordinationV1               *coordinationv1.CoordinationV1Client
    coreV1                       *corev1.CoreV1Client
    discoveryV1alpha1            *discoveryv1alpha1.DiscoveryV1alpha1Client
    eventsV1beta1                *eventsv1beta1.EventsV1beta1Client
    extensionsV1beta1            *extensionsv1beta1.ExtensionsV1beta1Client
    networkingV1                 *networkingv1.NetworkingV1Client
    networkingV1beta1            *networkingv1beta1.NetworkingV1beta1Client
    nodeV1alpha1                 *nodev1alpha1.NodeV1alpha1Client
    nodeV1beta1                  *nodev1beta1.NodeV1beta1Client
    policyV1beta1                *policyv1beta1.PolicyV1beta1Client
    rbacV1                       *rbacv1.RbacV1Client
    rbacV1beta1                  *rbacv1beta1.RbacV1beta1Client
    rbacV1alpha1                 *rbacv1alpha1.RbacV1alpha1Client
    schedulingV1alpha1           *schedulingv1alpha1.SchedulingV1alpha1Client
    schedulingV1beta1            *schedulingv1beta1.SchedulingV1beta1Client
    schedulingV1                 *schedulingv1.SchedulingV1Client
    settingsV1alpha1             *settingsv1alpha1.SettingsV1alpha1Client
    storageV1beta1               *storagev1beta1.StorageV1beta1Client
    storageV1                    *storagev1.StorageV1Client
    storageV1alpha1              *storagev1alpha1.StorageV1alpha1Client
}</code></pre><h4 id="Clientset-实现的接口"><a href="#Clientset-实现的接口" class="headerlink" title="Clientset 实现的接口"></a>Clientset 实现的接口</h4><pre><code>type Interface interface {
    Discovery() discovery.DiscoveryInterface
    AdmissionregistrationV1() admissionregistrationv1.AdmissionregistrationV1Interface
    AdmissionregistrationV1beta1() admissionregistrationv1beta1.AdmissionregistrationV1beta1Interface
    AppsV1() appsv1.AppsV1Interface
    AppsV1beta1() appsv1beta1.AppsV1beta1Interface
    AppsV1beta2() appsv1beta2.AppsV1beta2Interface
    AuditregistrationV1alpha1() auditregistrationv1alpha1.AuditregistrationV1alpha1Interface
    AuthenticationV1() authenticationv1.AuthenticationV1Interface
    AuthenticationV1beta1() authenticationv1beta1.AuthenticationV1beta1Interface
    AuthorizationV1() authorizationv1.AuthorizationV1Interface
    AuthorizationV1beta1() authorizationv1beta1.AuthorizationV1beta1Interface
    AutoscalingV1() autoscalingv1.AutoscalingV1Interface
    AutoscalingV2beta1() autoscalingv2beta1.AutoscalingV2beta1Interface
    AutoscalingV2beta2() autoscalingv2beta2.AutoscalingV2beta2Interface
    BatchV1() batchv1.BatchV1Interface
    BatchV1beta1() batchv1beta1.BatchV1beta1Interface
    BatchV2alpha1() batchv2alpha1.BatchV2alpha1Interface
    CertificatesV1beta1() certificatesv1beta1.CertificatesV1beta1Interface
    CoordinationV1beta1() coordinationv1beta1.CoordinationV1beta1Interface
    CoordinationV1() coordinationv1.CoordinationV1Interface
    CoreV1() corev1.CoreV1Interface
    DiscoveryV1alpha1() discoveryv1alpha1.DiscoveryV1alpha1Interface
    EventsV1beta1() eventsv1beta1.EventsV1beta1Interface
    ExtensionsV1beta1() extensionsv1beta1.ExtensionsV1beta1Interface
    NetworkingV1() networkingv1.NetworkingV1Interface
    NetworkingV1beta1() networkingv1beta1.NetworkingV1beta1Interface
    NodeV1alpha1() nodev1alpha1.NodeV1alpha1Interface
    NodeV1beta1() nodev1beta1.NodeV1beta1Interface
    PolicyV1beta1() policyv1beta1.PolicyV1beta1Interface
    RbacV1() rbacv1.RbacV1Interface
    RbacV1beta1() rbacv1beta1.RbacV1beta1Interface
    RbacV1alpha1() rbacv1alpha1.RbacV1alpha1Interface
    SchedulingV1alpha1() schedulingv1alpha1.SchedulingV1alpha1Interface
    SchedulingV1beta1() schedulingv1beta1.SchedulingV1beta1Interface
    SchedulingV1() schedulingv1.SchedulingV1Interface
    SettingsV1alpha1() settingsv1alpha1.SettingsV1alpha1Interface
    StorageV1beta1() storagev1beta1.StorageV1beta1Interface
    StorageV1() storagev1.StorageV1Interface
    StorageV1alpha1() storagev1alpha1.StorageV1alpha1Interface
}</code></pre><p>Clientset结构体实现了以上结构定义的所有方法。源码地址：k8s.io/client-go/kubernetes/clientset.go</p>
<p>因为Clientset可使用其中任意函数调用，如获取Pod列表。</p>
<pre><code>pods, err := clientset.CoreV1().Pods(&quot;&quot;).List(metav1.ListOptions{})</code></pre><h3 id="CoreV1Client对象创建"><a href="#CoreV1Client对象创建" class="headerlink" title="CoreV1Client对象创建"></a>CoreV1Client对象创建</h3><p>在创建Clientset对象时，Clientset 中的变量coreV1也被一起初始化创建。即创建了CoreV1Client对象。</p>
<pre><code>//coreV1 对象创建
cs.coreV1, err = corev1.NewForConfig(&amp;configShallowCopy)</code></pre><h4 id="NewForConfig"><a href="#NewForConfig" class="headerlink" title="NewForConfig"></a>NewForConfig</h4><pre><code>// NewForConfig creates a new CoreV1Client for the given config.
func NewForConfig(c *rest.Config) (*CoreV1Client, error) {
    config := *c
    if err := setConfigDefaults(&amp;config); err != nil {
        return nil, err
    }
    client, err := rest.RESTClientFor(&amp;config)
    if err != nil {
        return nil, err
    }
    return &amp;CoreV1Client{client}, nil
}</code></pre><h4 id="CoreV1Interface"><a href="#CoreV1Interface" class="headerlink" title="CoreV1Interface"></a>CoreV1Interface</h4><p>如下所示：</p>
<pre><code>type CoreV1Interface interface {
    RESTClient() rest.Interface
    ComponentStatusesGetter
    ConfigMapsGetter
    EndpointsGetter
    EventsGetter
    LimitRangesGetter
    NamespacesGetter
    NodesGetter
    PersistentVolumesGetter
    PersistentVolumeClaimsGetter
    PodsGetter
    PodTemplatesGetter
    ReplicationControllersGetter
    ResourceQuotasGetter
    SecretsGetter
    ServicesGetter
    ServiceAccountsGetter
}</code></pre><p>CoreV1Interface中包含了各种kubernetes对象的调用接口，例如PodsGetter是对kubernetes中pod对象增删改查操作的接口。ServicesGetter是对service对象的操作的接口。</p>
<h4 id="CoreV1Client-结构体"><a href="#CoreV1Client-结构体" class="headerlink" title="CoreV1Client 结构体"></a>CoreV1Client 结构体</h4><pre><code>type CoreV1Client struct {
    restClient rest.Interface
}</code></pre><p>CoreV1Client结构体实现了CoreV1Interface所有的定义函数。</p>
<pre><code>//CoreV1Client的方法
func (c *CoreV1Client) ComponentStatuses() ComponentStatusInterface
//ConfigMaps
func (c *CoreV1Client) ConfigMaps(namespace string) ConfigMapInterface
//Endpoints
func (c *CoreV1Client) Endpoints(namespace string) EndpointsInterface
func (c *CoreV1Client) Events(namespace string) EventInterface
func (c *CoreV1Client) LimitRanges(namespace string) LimitRangeInterface
//namespace
func (c *CoreV1Client) Namespaces() NamespaceInterface 
//nodes
func (c *CoreV1Client) Nodes() NodeInterface 
//pv
func (c *CoreV1Client) PersistentVolumes() PersistentVolumeInterface 
//pvc
func (c *CoreV1Client) PersistentVolumeClaims(namespace string) PersistentVolumeClaimInterface 
//pods 
func (c *CoreV1Client) Pods(namespace string) PodInterface 
func (c *CoreV1Client) PodTemplates(namespace string) PodTemplateInterface 
//rc
func (c *CoreV1Client) ReplicationControllers(namespace string) ReplicationControllerInterface 
func (c *CoreV1Client) ResourceQuotas(namespace string) ResourceQuotaInterface 
//secret
func (c *CoreV1Client) Secrets(namespace string) SecretInterface 
//service
func (c *CoreV1Client) Services(namespace string) ServiceInterface 
func (c *CoreV1Client) ServiceAccounts(namespace string) ServiceAccountInterface </code></pre><h3 id="PodsGetter接口"><a href="#PodsGetter接口" class="headerlink" title="PodsGetter接口"></a>PodsGetter接口</h3><pre><code>type PodsGetter interface {
    Pods(namespace string) PodInterface
}

func (c *CoreV1Client) Pods(namespace string) PodInterface {
    return newPods(c, namespace)
}</code></pre><p>PodsGetter接口中定义了Pods方法此方法返回PodInterface，这样就可以用Clients.Corev1().Pods()方法对Pod进行增删改查操作了。</p>
<h3 id="Pod对象创建"><a href="#Pod对象创建" class="headerlink" title="Pod对象创建"></a>Pod对象创建</h3><pre><code>func (c *CoreV1Client) Pods(namespace string) PodInterface {
    return newPods(c, namespace)
}

// newPods returns a Pods
func newPods(c *CoreV1Client, namespace string) *pods {
    return &amp;pods{
        client: c.RESTClient(),
        ns:     namespace,
    }
}</code></pre><p>调用Pods方法，再通过newPods函数创建一个Pods的对象。pods对象继承了rest.Interface接口，即最终的实现本质是RESTClient的HTTP调用。</p>
<h4 id="PodInterface接口"><a href="#PodInterface接口" class="headerlink" title="PodInterface接口"></a>PodInterface接口</h4><pre><code>// PodInterface has methods to work with Pod resources.
type PodInterface interface {
    Create(*v1.Pod) (*v1.Pod, error)
    Update(*v1.Pod) (*v1.Pod, error)
    UpdateStatus(*v1.Pod) (*v1.Pod, error)
    Delete(name string, options *metav1.DeleteOptions) error
    DeleteCollection(options *metav1.DeleteOptions, listOptions metav1.ListOptions) error
    Get(name string, options metav1.GetOptions) (*v1.Pod, error)
    List(opts metav1.ListOptions) (*v1.PodList, error)
    Watch(opts metav1.ListOptions) (watch.Interface, error)
    Patch(name string, pt types.PatchType, data []byte, subresources ...string) (result *v1.Pod, err error)
    GetEphemeralContainers(podName string, options metav1.GetOptions) (*v1.EphemeralContainers, error)
    UpdateEphemeralContainers(podName string, ephemeralContainers *v1.EphemeralContainers) (*v1.EphemeralContainers, error)

    PodExpansion
}</code></pre><p>PodInterface接口定义了Pod对象操作的所有方法。</p>
<h4 id="Pod结构体"><a href="#Pod结构体" class="headerlink" title="Pod结构体"></a>Pod结构体</h4><pre><code>// pods implements PodInterface
type pods struct {
    client rest.Interface
    ns     string
}</code></pre><p>Pod对象中继承了rest.Interface，上面提到过此client便是进行http请求调用。</p>
<h4 id="Pod-List方法"><a href="#Pod-List方法" class="headerlink" title="Pod List方法"></a>Pod List方法</h4><pre><code>// List takes label and field selectors, and returns the list of Pods that match those selectors.
func (c *pods) List(opts metav1.ListOptions) (result *v1.PodList, err error) {
    var timeout time.Duration
    if opts.TimeoutSeconds != nil {
        timeout = time.Duration(*opts.TimeoutSeconds) * time.Second
    }
    result = &amp;v1.PodList{}
    err = c.client.Get().
        Namespace(c.ns).
        Resource(&quot;pods&quot;).
        VersionedParams(&amp;opts, scheme.ParameterCodec).
        Timeout(timeout).
        Do().
        Into(result)
    return
}</code></pre><p>以上分析了clientset.CoreV1().Pods(“”).List(metav1.ListOptions{})对pod资源获取的过程，最终是调用RESTClient的方法实现。</p>
<h3 id="rest-client-对象创建"><a href="#rest-client-对象创建" class="headerlink" title="rest client 对象创建"></a>rest client 对象创建</h3><pre><code>// NewForConfig creates a new CoreV1Client for the given config.
func NewForConfig(c *rest.Config) (*CoreV1Client, error) {
    config := *c
    if err := setConfigDefaults(&amp;config); err != nil {
        return nil, err
    }
    client, err := rest.RESTClientFor(&amp;config)
    if err != nil {
        return nil, err
    }
    return &amp;CoreV1Client{client}, nil
}</code></pre><p>在CoreV1Client对象创建的时候也根据config对象调用est.RESTClientFor(&amp;config)函数创建了rest client对象。在创建Pod时将CoreV1Client对象的restClient赋值给Pod的client。</p>
<h4 id="rest-Interface"><a href="#rest-Interface" class="headerlink" title="rest.Interface"></a>rest.Interface</h4><pre><code>type Interface interface {
    GetRateLimiter() flowcontrol.RateLimiter
    Verb(verb string) *Request
    Post() *Request
    Put() *Request
    Patch(pt types.PatchType) *Request
    Get() *Request
    Delete() *Request
    APIVersion() schema.GroupVersion
}</code></pre><p>此接口定义了http请求的方法。</p>
<h4 id="RESTClient结构体"><a href="#RESTClient结构体" class="headerlink" title="RESTClient结构体"></a>RESTClient结构体</h4><pre><code>type RESTClient struct {
    // base is the root URL for all invocations of the client
    base *url.URL
    // versionedAPIPath is a path segment connecting the base URL to the resource root
    versionedAPIPath string

    // contentConfig is the information used to communicate with the server.
    contentConfig ContentConfig

    // serializers contain all serializers for underlying content type.
    serializers Serializers

    // creates BackoffManager that is passed to requests.
    createBackoffMgr func() BackoffManager

    // TODO extract this into a wrapper interface via the RESTClient interface in kubectl.
    Throttle flowcontrol.RateLimiter

    // Set specific behavior of the client.  If not set http.DefaultClient will be used.
    Client *http.Client
}</code></pre><h4 id="RESTClient对象实现的接口函数"><a href="#RESTClient对象实现的接口函数" class="headerlink" title="RESTClient对象实现的接口函数"></a>RESTClient对象实现的接口函数</h4><pre><code>func (c *RESTClient) Verb(verb string) *Request {
    backoff := c.createBackoffMgr()

    if c.Client == nil {
        return NewRequest(nil, verb, c.base, c.versionedAPIPath, c.contentConfig, c.serializers, backoff, c.Throttle, 0)
    }
    return NewRequest(c.Client, verb, c.base, c.versionedAPIPath, c.contentConfig, c.serializers, backoff, c.Throttle, c.Client.Timeout)
}

// Post begins a POST request. Short for c.Verb(&quot;POST&quot;).
func (c *RESTClient) Post() *Request {
    return c.Verb(&quot;POST&quot;)
}

// Put begins a PUT request. Short for c.Verb(&quot;PUT&quot;).
func (c *RESTClient) Put() *Request {
    return c.Verb(&quot;PUT&quot;)
}

// Patch begins a PATCH request. Short for c.Verb(&quot;Patch&quot;).
func (c *RESTClient) Patch(pt types.PatchType) *Request {
    return c.Verb(&quot;PATCH&quot;).SetHeader(&quot;Content-Type&quot;, string(pt))
}

// Get begins a GET request. Short for c.Verb(&quot;GET&quot;).
func (c *RESTClient) Get() *Request {
    return c.Verb(&quot;GET&quot;)
}

// Delete begins a DELETE request. Short for c.Verb(&quot;DELETE&quot;).
func (c *RESTClient) Delete() *Request {
    return c.Verb(&quot;DELETE&quot;)
}

// APIVersion returns the APIVersion this RESTClient is expected to use.
func (c *RESTClient) APIVersion() schema.GroupVersion {
    return *c.contentConfig.GroupVersion
}</code></pre><p>通过以上实现可以看出对着的接口调用都转到了Verb方法的调用。Verb方法通过传参调用NewRequest函数最终执行了一次http请求操作。</p>
<h4 id="NewRequest"><a href="#NewRequest" class="headerlink" title="NewRequest"></a>NewRequest</h4><pre><code>// NewRequest creates a new request helper object for accessing runtime.Objects on a server.
func NewRequest(client HTTPClient, verb string, baseURL *url.URL, versionedAPIPath string, content ContentConfig, serializers Serializers, backoff BackoffManager, throttle flowcontrol.RateLimiter, timeout time.Duration) *Request {
    if backoff == nil {
        klog.V(2).Infof(&quot;Not implementing request backoff strategy.&quot;)
        backoff = &amp;NoBackoff{}
    }

    pathPrefix := &quot;/&quot;
    if baseURL != nil {
        pathPrefix = path.Join(pathPrefix, baseURL.Path)
    }
    r := &amp;Request{
        client:      client,
        verb:        verb,
        baseURL:     baseURL,
        pathPrefix:  path.Join(pathPrefix, versionedAPIPath),
        content:     content,
        serializers: serializers,
        backoffMgr:  backoff,
        throttle:    throttle,
        timeout:     timeout,
    }
    switch {
    case len(content.AcceptContentTypes) &gt; 0:
        r.SetHeader(&quot;Accept&quot;, content.AcceptContentTypes)
    case len(content.ContentType) &gt; 0:
        r.SetHeader(&quot;Accept&quot;, content.ContentType+&quot;, */*&quot;)
    }
    return r
}</code></pre><p>可以看到NewRequest最终将参数组成http请求参数进行了http请求调用。至此clientset.CoreV1().Pods(“”).List(metav1.ListOptions{})调用完成，最终将结果返回。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>client-go对kubernetes资源对象的调用操作，需要先获取kubernetes的配置信息，即$HOME/.kube/config。(master节点)</p>
<p>具体流程如下图所示：</p>
<p><img src="/" class="lazyload" data-src="https://upload-images.jianshu.io/upload_images/17904159-18812fcf012e02b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"  alt="client-go-request.png"></p>
<h2 id="client-go对k8s资源的调用"><a href="#client-go对k8s资源的调用" class="headerlink" title="client-go对k8s资源的调用"></a>client-go对k8s资源的调用</h2><h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><pre><code>Clientset.CoreV1().Services(nameSpace).Create(serviceObj)
Clientset.CoreV1().Services(nameSpace).Update(serviceObj)
Clientset.CoreV1().Services(nameSpace).Delete(serviceName, &amp;meta_v1.DeleteOptions{})
Clientset.CoreV1().Services(nameSpace).Get(serviceName, meta_v1.GetOptions{})
Clientset.CoreV1().Services(nameSpace).List(meta_v1.ListOptions{})
Clientset.CoreV1().Services(nameSpace).Watch(meta_v1.ListOptions{})</code></pre><h3 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h3><pre><code>Clientset.AppsV1beta1().Deployments(nameSpace).Create(deploymentObj)
Clientset.AppsV1beta1().Deployments(nameSpace).Update(deploymentObj)
Clientset.AppsV1beta1().Deployments(nameSpace).Delete(deploymentName, &amp;meta_v1.DeleteOptions{})
Clientset.AppsV1beta1().Deployments(nameSpace).Get(deploymentName, meta_v1.GetOptions{})
Clientset.AppsV1beta1().Deployments(nameSpace).List(meta_v1.ListOptions{})
Clientset.AppsV1beta1().Deployments(nameSpace).Watch(meta_v1.ListOptions{})</code></pre><h3 id="ReplicaSet"><a href="#ReplicaSet" class="headerlink" title="ReplicaSet"></a>ReplicaSet</h3><pre><code>Clientset.ExtensionsV1beta1().ReplicaSets(nameSpace).Create(replicasetsObj)
Clientset.ExtensionsV1beta1().ReplicaSets(nameSpace).Update(replicasetsObj)
Clientset.ExtensionsV1beta1().ReplicaSets(nameSpace).Delete(replicaSetName, &amp;meta_v1.DeleteOptions{})
Clientset.ExtensionsV1beta1().ReplicaSets(nameSpace).Get(replicaSetName, meta_v1.GetOptions{})
Clientset.ExtensionsV1beta1().ReplicaSets(nameSpace).List(meta_v1.ListOptions{})
Clientset.ExtensionsV1beta1().ReplicaSets(nameSpace).Watch(meta_v1.ListOptions{})</code></pre><h3 id="Ingresse"><a href="#Ingresse" class="headerlink" title="Ingresse"></a>Ingresse</h3><pre><code>Clientset.ExtensionsV1beta1().Ingresses(nameSpace).Create(ingressObj)
Clientset.ExtensionsV1beta1().Ingresses(nameSpace).Update(ingressObj)
Clientset.ExtensionsV1beta1().Ingresses(nameSpace).Delete(ingressName, &amp;meta_v1.DeleteOptions{})
Clientset.ExtensionsV1beta1().Ingresses(nameSpace).Get(ingressName, meta_v1.GetOptions{})
Clientset.ExtensionsV1beta1().Ingresses(nameSpace).List(meta_v1.ListOptions{})</code></pre><h3 id="StatefulSet"><a href="#StatefulSet" class="headerlink" title="StatefulSet"></a>StatefulSet</h3><pre><code>Clientset.AppsV1beta1().StatefulSets(nameSpace).Create(statefulSetObj)
Clientset.AppsV1beta1().StatefulSets(nameSpace).Update(statefulSetObj)
Clientset.AppsV1beta1().StatefulSets(nameSpace).Delete(statefulSetName, &amp;meta_v1.DeleteOptions{})
Clientset.AppsV1beta1().StatefulSets(nameSpace).Get(statefulSetName, meta_v1.GetOptions{})
Clientset.AppsV1beta1().StatefulSets(nameSpace).List(meta_v1.ListOptions{})</code></pre><h3 id="DaemonSet"><a href="#DaemonSet" class="headerlink" title="DaemonSet"></a>DaemonSet</h3><pre><code>Clientset.ExtensionsV1beta1().DaemonSets(nameSpace).Create(daemonSetObj)
Clientset.ExtensionsV1beta1().DaemonSets(nameSpace).Update(daemonSetObj)
Clientset.ExtensionsV1beta1().DaemonSets(nameSpace).Delete(daemonSetName, &amp;meta_v1.DeleteOptions{})
Clientset.ExtensionsV1beta1().DaemonSets(nameSpace).Get(daemonSetName, meta_v1.GetOptions{})
Clientset.ExtensionsV1beta1().DaemonSets(nameSpace).List(meta_v1.ListOptions{})</code></pre><h3 id="ReplicationController"><a href="#ReplicationController" class="headerlink" title="ReplicationController"></a>ReplicationController</h3><pre><code>Clientset.CoreV1().ReplicationControllers(nameSpace).Create(replicationControllerObj)
Clientset.CoreV1().ReplicationControllers(nameSpace).Update(replicationControllerObj)
Clientset.CoreV1().ReplicationControllers(nameSpace).Delete(replicationControllerName, &amp;meta_v1.DeleteOptions{})
Clientset.CoreV1().ReplicationControllers(nameSpace).Get(replicationControllerName, meta_v1.GetOptions{})
Clientset.CoreV1().ReplicationControllers(nameSpace).List(meta_v1.ListOptions{})</code></pre><h3 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h3><pre><code>Clientset.CoreV1().Secrets(nameSpace).Create(secretObj)
Clientset.CoreV1().Secrets(nameSpace).Update(secretObj)
Clientset.CoreV1().Secrets(nameSpace).Delete(secretName, &amp;meta_v1.DeleteOptions{})
Clientset.CoreV1().Secrets(nameSpace).Get(secretName, meta_v1.GetOptions{})
Clientset.CoreV1().Secrets(nameSpace).List(meta_v1.ListOptions{})</code></pre><h3 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h3><pre><code>Clientset.CoreV1().ConfigMaps(nameSpace).Create(configMapObj)
Clientset.CoreV1().ConfigMaps(nameSpace).Update(configMapObj)
Clientset.CoreV1().ConfigMaps(nameSpace).Delete(configMapName, &amp;meta_v1.DeleteOptions{})
Clientset.CoreV1().ConfigMaps(nameSpace).Get(configMapName, meta_v1.GetOptions{})
Clientset.CoreV1().ConfigMaps(nameSpace).List(meta_v1.ListOptions{})</code></pre><h3 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h3><pre><code>Clientset.CoreV1().Pods(nameSpace).Get(podName, meta_v1.GetOptions{})
Clientset.CoreV1().Pods(nameSpace).List(meta_v1.ListOptions{})
Clientset.CoreV1().Pods(nameSpace).Delete(podName, &amp;meta_v1.DeleteOptions{})</code></pre><h3 id="Namespace"><a href="#Namespace" class="headerlink" title="Namespace"></a>Namespace</h3><pre><code>Clientset.CoreV1().Namespaces().Create(nsSpec)
Clientset.CoreV1().Namespaces().Get(nameSpace, meta_v1.GetOptions{})
Clientset.CoreV1().Namespaces().List(meta_v1.ListOptions{})</code></pre></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Frederick Hou</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/04/10/2020-04-10-Golang-client-go-analysis/">http://yoursite.com/2020/04/10/2020-04-10-Golang-client-go-analysis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">Frederick Hou Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Golang/">Golang</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg3.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/12/2020-04-11-Golang-factory-model/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg2.png" onerror="onerror=null;src='/img/404-bg.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Golang 工厂模式</div></div></a></div><div class="next-post pull_right"><a href="/2020/04/09/2020-04-09-linux_dead_mutex/"><img class="next_cover lazyload" data-src="/img/post.jpg" onerror="onerror=null;src='/img/404-bg.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">死锁介绍</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/14/2020-04-14-Golang-select/" title="Golang select介绍"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-14</div><div class="relatedPosts_title">Golang select介绍</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/14/2020-04-14-Golang-range/" title="Golang range 的坑"><img class="relatedPosts_cover lazyload"data-src="/img/post.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-14</div><div class="relatedPosts_title">Golang range 的坑</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/12/2020-04-11-Golang-factory-model/" title="Golang 工厂模式"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg2.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-12</div><div class="relatedPosts_title">Golang 工厂模式</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/09/2020-04-09-Golang-interface/" title="Golang interface"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg3.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-09</div><div class="relatedPosts_title">Golang interface</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/08/2020-04-03-Golang_memory_manager/" title="Golang 内存分配"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg2.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-08</div><div class="relatedPosts_title">Golang 内存分配</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/03/2020-04-03-Golang_array_slice/" title="Golang 数组和切片"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg2.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-03</div><div class="relatedPosts_title">Golang 数组和切片</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '9773f8d7d3b21b9b4318',
  clientSecret: '6ded13787b3949f9722495059669573ba071d216',
  repo: 'FrederickHou.github.io',
  owner: 'frederickhou',
  admin: ['frederickhou'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 10,
  distractionFreeMode: true,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg3.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2020 By Frederick Hou</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://www.frederickhou.com/" target="_blank" rel="noopener">blog</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/ClickShowText.js"></script><script src="/js/search/local-search.js"></script></body></html>